import{M as q}from"./Modal.8c4222ba.js";import{D as F}from"./Dropdown.6fe779dc.js";import{d as g,l as O,r as I,m as h,_ as M,x as z,w,f as k,o as p,b as t,c as f,e as P,q as G,t as E,F as B,g as S,D as H,y as C,i as L,a as N,h as A,v as $,p as R,j as J}from"./index.daa4adef.js";const K=g({props:{requestNum:{type:Number,default:0},initialSelectedId:{type:Number,default:void 0},items:{type:Array,default:()=>[]}},components:{Modal:q},setup(e,{emit:l}){O(()=>e.requestNum,(i,u)=>{i>u&&d()});const c=I(void 0),y=h(()=>e.items[c.value]),v=I(!1);function d(){v.value=!0,c.value=e.items.findIndex(i=>i.id===e.initialSelectedId)}function m(){l("select",y.value.id),v.value=!1}return{modalState:v,selectedIndex:c,selectedItem:y,onSubmit:m}}}),Q=["onClick"],W=t("hr",null,null,-1),Y={key:0},Z=t("h3",null,"Item detail",-1),x=t("b",null,"\u0E23\u0E2B\u0E31\u0E2A\u0E2A\u0E34\u0E19\u0E04\u0E49\u0E32",-1),tt=t("br",null,null,-1),et=t("br",null,null,-1),ut=t("br",null,null,-1),nt=t("b",null,"\u0E0A\u0E37\u0E48\u0E2D\u0E2A\u0E34\u0E19\u0E04\u0E49\u0E32",-1),ot=t("br",null,null,-1),lt=t("br",null,null,-1),st=t("br",null,null,-1),it=t("b",null,"\u0E23\u0E32\u0E04\u0E32",-1),dt=t("br",null,null,-1),at={key:1};function Et(e,l,c,y,v,d){const m=k("Modal");return p(),z(m,{shown:e.modalState,"onUpdate:shown":l[2]||(l[2]=i=>e.modalState=i),heading:"\u0E40\u0E25\u0E37\u0E2D\u0E01\u0E2A\u0E34\u0E19\u0E04\u0E49\u0E32"},{body:w(()=>[t("ul",null,[(p(!0),f(B,null,P(e.items,(i,u)=>(p(),f("li",{key:u,onClick:r=>e.selectedIndex=u,class:G({"text-primary":e.selectedIndex===u})},E(i.name),11,Q))),128))]),W,e.selectedItem?(p(),f("div",Y,[Z,x,tt,S(" "+E(e.selectedItem.code),1),et,ut,nt,ot,S(" "+E(e.selectedItem.name),1),lt,st,it,dt,S(" "+E(e.selectedItem.price),1)])):(p(),f("p",at,"No Item Selected"))]),footer:w(()=>[t("button",{type:"button",class:"btn btn-secondary",onClick:l[0]||(l[0]=i=>e.modalState=!1)},"Close"),t("button",{type:"button",class:"btn btn-primary",onClick:l[1]||(l[1]=(...i)=>e.onSubmit&&e.onSubmit(...i))},"Select this item")]),_:1},8,["shown"])}const ct=M(K,[["render",Et]]),mt=g({components:{Modal:q,Dropdown:F,ModalSelectItem:ct},setup(){const e=L("datastore"),l=I([]);e.unit.getAllUnits().then(o=>{l.value=o});const c=I([]);e.item.getAllItems().then(o=>{c.value=o});const y=H.now().set({hour:0,minute:0,second:0,millisecond:0}),v=h(()=>y.toFormat("dd/MM/yyyy")),d=I([]),m=h(()=>{let o=0;for(const{itemPrice:n,quantity:a}of d.value)o+=n*a;return o}),i=h(()=>{let o=0;for(const{discountAmount:n}of d.value)o+=n;return o}),u=h(()=>m.value-i.value),r=I(0),_=h(()=>Math.max(u.value-r.value,0)),b=C({requestNum:0,initialSelectedID:void 0,rowIndex:0});function U(o){b.rowIndex=o,b.initialSelectedID=o||o===0?d.value[o].itemID:void 0,b.requestNum++}function T(o){const n=c.value.find(D=>D.id===o);let a=C({itemID:n.id,itemCode:n.code,itemName:n.name,itemUnitName:l.value.find(D=>D.id===n.unitID).name,itemPrice:n.price,quantity:0,discountPercentage:0,discountAmount:h(()=>Math.min(a.discountPercentage/100,1)*(a.itemPrice*a.quantity)),amount:h(()=>a.itemPrice*a.quantity-a.discountAmount)});b.rowIndex!==null&&b.rowIndex!==void 0?d.value[b.rowIndex]=a:d.value.push(a)}function V(){const o=d.value;for(const n of o)if(!n.quantity){alert("quantity is empty");return}e.receipt.addReceipt({details:o.map(n=>{var a;return{itemID:n.itemID,itemCode:n.itemCode,itemName:n.itemName,itemUnitName:(a=l.value.find(D=>D.id===c.value.find(j=>j.id===n.itemID).unitID))==null?void 0:a.name,itemPrice:n.itemPrice,quantity:n.quantity,discountAmount:n.discountAmount,discountPercentage:n.discountPercentage,amount:n.amount}}),subtotalBeforeDiscount:m.value,totalItemDiscount:i.value,subtotal:u.value,tradeDiscount:r.value,grandTotal:_.value}).then(async()=>{d.value=[]}).catch(n=>alert(n))}function X(o){d.value.splice(o,1)}return{items:c,todayText:v,detailItems:d,subtotalBeforeDiscount:m,totalItemDiscount:i,subtotal:u,tradeDiscount:r,grandTotal:_,modalSelectItem:b,openModalSelectItem:U,onSelectItem:T,onSubmit:V,onDelete:X}}});const s=e=>(R("data-v-019c9878"),e=e(),J(),e),rt=s(()=>t("h2",null,"\u0E2D\u0E2D\u0E01\u0E43\u0E1A\u0E40\u0E2A\u0E23\u0E47\u0E08\u0E23\u0E31\u0E1A\u0E40\u0E07\u0E34\u0E19",-1)),_t=s(()=>t("div",{class:"row"},[t("div",{class:"col-md-3"},[t("label",null,"\u0E40\u0E25\u0E02\u0E17\u0E35\u0E48\u0E40\u0E2D\u0E01\u0E2A\u0E32\u0E23"),t("br"),t("input",{type:"text",value:"TXXXX",disabled:""})])],-1)),ht={class:"row"},pt={class:"col-md-3"},vt=s(()=>t("label",null,"\u0E27\u0E31\u0E19\u0E17\u0E35\u0E48",-1)),bt=s(()=>t("br",null,null,-1)),ft=["value"],yt={class:"table-detail"},It=s(()=>t("thead",null,[t("tr",null,[t("th",{width:"5%"},"No."),t("th",{width:"15%"},"\u0E23\u0E2B\u0E31\u0E2A\u0E2A\u0E34\u0E19\u0E04\u0E49\u0E32"),t("th",{width:"15%"},"\u0E0A\u0E37\u0E48\u0E2D\u0E2A\u0E34\u0E19\u0E04\u0E49\u0E32"),t("th",{width:"5%"},"\u0E2B\u0E19\u0E48\u0E27\u0E22"),t("th",{width:"5%"},"\u0E08\u0E33\u0E19\u0E27\u0E19"),t("th",{width:"15%"},"\u0E23\u0E32\u0E04\u0E32"),t("th",{width:"10%"},"\u0E2A\u0E48\u0E27\u0E19\u0E25\u0E14 (%)"),t("th",{width:"10%"},"\u0E2A\u0E48\u0E27\u0E19\u0E25\u0E14 (\u0E1A\u0E32\u0E17)"),t("th",{width:"20%"},"\u0E23\u0E27\u0E21\u0E40\u0E07\u0E34\u0E19"),t("th",{width:"5%"},"\u0E14\u0E33\u0E40\u0E19\u0E34\u0E19\u0E01\u0E32\u0E23")])],-1)),Dt={id:"tbody"},St=["onClick"],At=["onUpdate:modelValue"],$t=["onUpdate:modelValue"],wt={class:"text-center"},kt=["onClick"],Ct=s(()=>t("td",null,null,-1)),Nt=s(()=>t("td",null,null,-1)),qt=s(()=>t("td",null,[t("input",{type:"number",disabled:"",value:0})],-1)),gt=s(()=>t("td",null,"0",-1)),Mt=s(()=>t("td",null,[t("input",{type:"number",disabled:"",value:0})],-1)),Pt=s(()=>t("td",null,[t("input",{type:"number",disabled:"",value:0})],-1)),Bt=s(()=>t("td",null,"0",-1)),Ut=s(()=>t("td",{class:"text-center"},[t("button",{disabled:""},"\u0E25\u0E1A")],-1)),Tt={class:"summary"},Vt={class:"field"},Xt=s(()=>t("span",null,"\u0E22\u0E2D\u0E14\u0E23\u0E27\u0E21\u0E2A\u0E34\u0E19\u0E04\u0E49\u0E32\u0E01\u0E48\u0E2D\u0E19\u0E2A\u0E48\u0E27\u0E19\u0E25\u0E14",-1)),jt=["value"],Ft={class:"field"},Ot=s(()=>t("span",null,"\u0E22\u0E2D\u0E14\u0E23\u0E27\u0E21\u0E2A\u0E48\u0E27\u0E19\u0E25\u0E14\u0E2A\u0E34\u0E19\u0E04\u0E49\u0E32",-1)),zt=["value"],Gt={class:"field"},Ht=s(()=>t("span",null,"Subtotal",-1)),Lt=["value"],Rt={class:"field"},Jt=s(()=>t("span",null,"\u0E2A\u0E48\u0E27\u0E19\u0E25\u0E14\u0E01\u0E32\u0E23\u0E04\u0E49\u0E32",-1)),Kt={class:"field"},Qt=s(()=>t("span",null,"Grand total",-1)),Wt=["value"],Yt={class:"d-flex justify-content-end"};function Zt(e,l,c,y,v,d){const m=k("router-link"),i=k("ModalSelectItem");return p(),f("div",null,[N(m,{to:{name:"Home"}},{default:w(()=>[S("\u0E01\u0E25\u0E31\u0E1A")]),_:1}),rt,_t,t("div",ht,[t("div",pt,[vt,bt,t("input",{type:"text",value:e.todayText,disabled:""},null,8,ft)])]),t("table",yt,[It,t("tbody",Dt,[(p(!0),f(B,null,P(e.detailItems,(u,r)=>(p(),f("tr",{key:r},[t("td",null,E(r+1),1),t("td",null,[t("button",{onClick:_=>e.openModalSelectItem(r)},E(u.itemCode),9,St)]),t("td",null,E(u.itemName),1),t("td",null,E(u.itemUnitName),1),t("td",null,[A(t("input",{type:"number","onUpdate:modelValue":_=>u.quantity=_},null,8,At),[[$,u.quantity]])]),t("td",null,E(u.itemPrice),1),t("td",null,[A(t("input",{type:"number","onUpdate:modelValue":_=>u.discountPercentage=_},null,8,$t),[[$,u.discountPercentage]])]),t("td",null,E(u.discountAmount),1),t("td",null,E(u.amount),1),t("td",wt,[t("button",{onClick:_=>e.onDelete(r)},"\u0E25\u0E1A",8,kt)])]))),128)),t("tr",null,[t("td",null,E(e.detailItems.length+1),1),t("td",null,[t("button",{onClick:l[0]||(l[0]=u=>e.openModalSelectItem(null))},"\u0E40\u0E25\u0E37\u0E2D\u0E01\u0E2A\u0E34\u0E19\u0E04\u0E49\u0E32")]),Ct,Nt,qt,gt,Mt,Pt,Bt,Ut])])]),t("div",Tt,[t("div",Vt,[Xt,t("input",{disabled:"",value:e.subtotalBeforeDiscount},null,8,jt)]),t("div",Ft,[Ot,t("input",{disabled:"",value:e.totalItemDiscount},null,8,zt)]),t("div",Gt,[Ht,t("input",{disabled:"",value:e.subtotal},null,8,Lt)]),t("div",Rt,[Jt,A(t("input",{type:"number","onUpdate:modelValue":l[1]||(l[1]=u=>e.tradeDiscount=u)},null,512),[[$,e.tradeDiscount]])]),t("div",Kt,[Qt,t("input",{disabled:"",value:e.grandTotal},null,8,Wt)])]),t("div",Yt,[t("button",{onClick:l[2]||(l[2]=(...u)=>e.onSubmit&&e.onSubmit(...u))},"\u0E1A\u0E31\u0E19\u0E17\u0E36\u0E01")]),N(i,{items:e.items,"request-num":e.modalSelectItem.requestNum,"initial-selected-id":e.modalSelectItem.initialSelectedID,onSelect:e.onSelectItem},null,8,["items","request-num","initial-selected-id","onSelect"])])}const ue=M(mt,[["render",Zt],["__scopeId","data-v-019c9878"]]);export{ue as default};
